<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/lw_initials.png"> <title>map project</title> <link rel=icon  type="image/png" href="/assets/lw_initials.png"> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/menu1/">Code blocks</a> <li><a href="/menu2/">More goodies</a> <li><a href="/menu3/">Tags</a> --> <li><a href="/menu_mine/">nice plots</a> <li><a href="/menu_mine2/">just plots</a> <li><a href="/menu_mine3/">CallR</a> <li><a href="/menu_mine4/">NN with MNIST</a> <li><a href="/menu_mine5/">map project</a> </ul> </div> <div id=main > <div class=franklin-content ><h1 id=map_project ><a href="#map_project" class=header-anchor >map project</a></h1> <p>Here will be the full map tutorial</p> <pre><code class="R hljs">library<span class=hljs-punctuation >(</span>rayshader<span class=hljs-punctuation >)</span>
library<span class=hljs-punctuation >(</span>sp<span class=hljs-punctuation >)</span>
library<span class=hljs-punctuation >(</span>raster<span class=hljs-punctuation >)</span>
library<span class=hljs-punctuation >(</span>scales<span class=hljs-punctuation >)</span></code></pre> <p>We will then read in the raster elevation data and visualize it.</p> <pre><code class="R hljs">elevation1 <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;N46E006.hgt&quot;</span><span class=hljs-punctuation >)</span>
elevation2 <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;N46E007.hgt&quot;</span><span class=hljs-punctuation >)</span>
elevation3 <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;N45E006.hgt&quot;</span><span class=hljs-punctuation >)</span>
elevation4 <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;N45E007.hgt&quot;</span><span class=hljs-punctuation >)</span>
tmb_elevation <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>merge<span class=hljs-punctuation >(</span>elevation1<span class=hljs-punctuation >,</span>elevation2<span class=hljs-punctuation >,</span>elevation3<span class=hljs-punctuation >,</span>elevation4<span class=hljs-punctuation >)</span>

height_shade<span class=hljs-punctuation >(</span>raster_to_matrix<span class=hljs-punctuation >(</span>tmb_elevation<span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span> <span class=hljs-operator >|&gt;</span> plot_map<span class=hljs-punctuation >(</span><span class=hljs-punctuation >)</span></code></pre> <img src="/images/elev_data.png" alt=""> <p>Next, we can read in the satellite imagery data.</p> <pre><code class="R hljs">tmb_r <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;LC08_L1TP_195028_20220918_20220928_02_T1_B4.TIF&quot;</span><span class=hljs-punctuation >)</span>
tmb_g <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;LC08_L1TP_195028_20220918_20220928_02_T1_B3.TIF&quot;</span><span class=hljs-punctuation >)</span>
tmb_b <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>raster<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;LC08_L1TP_195028_20220918_20220928_02_T1_B2.TIF&quot;</span><span class=hljs-punctuation >)</span>
tmb_rgb <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>stack<span class=hljs-punctuation >(</span>tmb_r<span class=hljs-punctuation >,</span> tmb_g<span class=hljs-punctuation >,</span> tmb_b<span class=hljs-punctuation >)</span>

raster<span class=hljs-operator >::</span>plotRGB<span class=hljs-punctuation >(</span>tmb_rgb<span class=hljs-punctuation >,</span> scale <span class=hljs-operator >=</span> <span class=hljs-number >255</span><span class=hljs-operator >^</span><span class=hljs-number >2</span><span class=hljs-punctuation >)</span></code></pre> <img src="/images/sat_image.png" alt=""> <p>This image is awfully dark. Let&#39;s brighten it by doing a gamma correction.</p> <pre><code class="R hljs">tmb_rgb_corrected <span class=hljs-operator >&lt;-</span> <span class=hljs-built_in >sqrt</span><span class=hljs-punctuation >(</span>tmb_rgb<span class=hljs-punctuation >)</span>

raster<span class=hljs-operator >::</span>plotRGB<span class=hljs-punctuation >(</span>tmb_rgb_corrected<span class=hljs-punctuation >)</span></code></pre> <img src="/images/sat_image_corrected.png" alt=""> <p>If we take a look at the coordinate reference systems of our two datasets, we can see that they differ.</p> <pre><code class="R hljs">raster<span class=hljs-operator >::</span>crs<span class=hljs-punctuation >(</span>tmb_r<span class=hljs-punctuation >)</span> <span class=hljs-comment ># +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs </span>
raster<span class=hljs-operator >::</span>crs<span class=hljs-punctuation >(</span>tmb_elevation<span class=hljs-punctuation >)</span> <span class=hljs-comment ># +proj=longlat +datum=WGS84 +no_defs</span>

tmb_elevation_utm <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>projectRaster<span class=hljs-punctuation >(</span>tmb_elevation<span class=hljs-punctuation >,</span> crs <span class=hljs-operator >=</span> crs<span class=hljs-punctuation >(</span>tmb_r<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> method <span class=hljs-operator >=</span> <span class=hljs-string >&quot;bilinear&quot;</span><span class=hljs-punctuation >)</span>
crs<span class=hljs-punctuation >(</span>tmb_elevation_utm<span class=hljs-punctuation >)</span> <span class=hljs-comment ># +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs -- it worked</span></code></pre> <p>Finally, we can crop the region to our specified area, which in my case is roughly the route of the Tour du Mont Blanc.</p> <pre><code class="R hljs">bottom_left <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>y <span class=hljs-operator >=</span> <span class=hljs-number >6.620446</span><span class=hljs-punctuation >,</span> x <span class=hljs-operator >=</span> <span class=hljs-number >45.657366</span><span class=hljs-punctuation >)</span>
top_right   <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>y <span class=hljs-operator >=</span> <span class=hljs-number >7.222736</span><span class=hljs-punctuation >,</span> x <span class=hljs-operator >=</span> <span class=hljs-number >46.053004</span><span class=hljs-punctuation >)</span>

extent_latlong <span class=hljs-operator >=</span> sp<span class=hljs-operator >::</span>SpatialPoints<span class=hljs-punctuation >(</span>rbind<span class=hljs-punctuation >(</span>bottom_left<span class=hljs-punctuation >,</span> top_right<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> proj4string<span class=hljs-operator >=</span>sp<span class=hljs-operator >::</span>CRS<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;+proj=longlat +ellps=WGS84 +datum=WGS84&quot;</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span>
<span class=hljs-comment >#extent_utm = sp::spTransform(extent_latlong, raster::crs(tmb_elevation_utm))</span>

e <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>extent<span class=hljs-punctuation >(</span>extent_latlong<span class=hljs-punctuation >)</span></code></pre> <p>The resulting extent e is:</p> <p>class : Extent xmin : 6.620446 xmax : 7.222736 ymin : 45.65737 ymax : 46.053</p> <p>Our datasets can now be cropped according to the extent <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span> we specified.</p> <pre><code class="R hljs">tmb_test <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>projectRaster<span class=hljs-punctuation >(</span>tmb_elevation_utm<span class=hljs-punctuation >,</span> crs <span class=hljs-operator >=</span> crs<span class=hljs-punctuation >(</span>tmb_elevation<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> method <span class=hljs-operator >=</span> <span class=hljs-string >&quot;bilinear&quot;</span><span class=hljs-punctuation >)</span>
tmb_test_rgb <span class=hljs-operator >&lt;-</span> raster<span class=hljs-operator >::</span>projectRaster<span class=hljs-punctuation >(</span>tmb_rgb_corrected<span class=hljs-punctuation >,</span> crs <span class=hljs-operator >=</span> crs<span class=hljs-punctuation >(</span>tmb_elevation<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> method <span class=hljs-operator >=</span> <span class=hljs-string >&quot;bilinear&quot;</span><span class=hljs-punctuation >)</span>

tmb_rgb_cropped <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>crop<span class=hljs-punctuation >(</span>tmb_test_rgb<span class=hljs-punctuation >,</span> e<span class=hljs-punctuation >)</span>
elevation_cropped <span class=hljs-operator >=</span> raster<span class=hljs-operator >::</span>crop<span class=hljs-punctuation >(</span>tmb_test<span class=hljs-punctuation >,</span> e<span class=hljs-punctuation >)</span>

<span class=hljs-built_in >names</span><span class=hljs-punctuation >(</span>tmb_rgb_cropped<span class=hljs-punctuation >)</span> <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span><span class=hljs-string >&quot;r&quot;</span><span class=hljs-punctuation >,</span><span class=hljs-string >&quot;g&quot;</span><span class=hljs-punctuation >,</span><span class=hljs-string >&quot;b&quot;</span><span class=hljs-punctuation >)</span>

tmb_r_cropped <span class=hljs-operator >=</span> rayshader<span class=hljs-operator >::</span>raster_to_matrix<span class=hljs-punctuation >(</span>tmb_rgb_cropped<span class=hljs-operator >$</span>r<span class=hljs-punctuation >)</span>
tmb_g_cropped <span class=hljs-operator >=</span> rayshader<span class=hljs-operator >::</span>raster_to_matrix<span class=hljs-punctuation >(</span>tmb_rgb_cropped<span class=hljs-operator >$</span>g<span class=hljs-punctuation >)</span>
tmb_b_cropped <span class=hljs-operator >=</span> rayshader<span class=hljs-operator >::</span>raster_to_matrix<span class=hljs-punctuation >(</span>tmb_rgb_cropped<span class=hljs-operator >$</span>b<span class=hljs-punctuation >)</span>

tmb_el_matrix <span class=hljs-operator >=</span> rayshader<span class=hljs-operator >::</span>raster_to_matrix<span class=hljs-punctuation >(</span>elevation_cropped<span class=hljs-punctuation >)</span>

tmb_rgb_array <span class=hljs-operator >=</span> array<span class=hljs-punctuation >(</span><span class=hljs-number >0</span><span class=hljs-punctuation >,</span><span class=hljs-built_in >dim</span><span class=hljs-operator >=</span><span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>nrow<span class=hljs-punctuation >(</span>tmb_r_cropped<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span>ncol<span class=hljs-punctuation >(</span>tmb_r_cropped<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span><span class=hljs-number >3</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span>

tmb_rgb_array<span class=hljs-punctuation >[</span><span class=hljs-punctuation >,</span><span class=hljs-punctuation >,</span><span class=hljs-number >1</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >=</span> tmb_r_cropped<span class=hljs-operator >/</span><span class=hljs-number >255</span> <span class=hljs-comment >#Red layer</span>
tmb_rgb_array<span class=hljs-punctuation >[</span><span class=hljs-punctuation >,</span><span class=hljs-punctuation >,</span><span class=hljs-number >2</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >=</span> tmb_g_cropped<span class=hljs-operator >/</span><span class=hljs-number >255</span> <span class=hljs-comment >#Blue layer</span>
tmb_rgb_array<span class=hljs-punctuation >[</span><span class=hljs-punctuation >,</span><span class=hljs-punctuation >,</span><span class=hljs-number >3</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >=</span> tmb_b_cropped<span class=hljs-operator >/</span><span class=hljs-number >255</span> <span class=hljs-comment >#Green layer</span>

tmb_rgb_array <span class=hljs-operator >=</span> aperm<span class=hljs-punctuation >(</span>tmb_rgb_array<span class=hljs-punctuation >,</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span><span class=hljs-number >2</span><span class=hljs-punctuation >,</span><span class=hljs-number >1</span><span class=hljs-punctuation >,</span><span class=hljs-number >3</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span></code></pre> <p>As a last step we rescale for improved contrast.</p> <pre><code class="R hljs">tmb_rgb_contrast <span class=hljs-operator >=</span> scales<span class=hljs-operator >::</span>rescale<span class=hljs-punctuation >(</span>tmb_rgb_array<span class=hljs-punctuation >,</span>to<span class=hljs-operator >=</span><span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span><span class=hljs-number >0</span><span class=hljs-punctuation >,</span><span class=hljs-number >1</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span>
plot_map<span class=hljs-punctuation >(</span>tmb_rgb_contrast<span class=hljs-punctuation >)</span></code></pre> <img src="/images/tmb_rgb_contrast_map.png" alt=""> <p>Our map can now be visualized in various ways. For example, let&#39;s plot it in 3D.</p> <pre><code class="R hljs">plot_3d<span class=hljs-punctuation >(</span>tmb_rgb_contrast<span class=hljs-punctuation >,</span> tmb_el_matrix<span class=hljs-punctuation >,</span> windowsize <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span><span class=hljs-number >800</span><span class=hljs-punctuation >,</span><span class=hljs-number >800</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> zscale <span class=hljs-operator >=</span> <span class=hljs-number >15</span><span class=hljs-punctuation >,</span> shadowdepth <span class=hljs-operator >=</span> <span class=hljs-operator >-</span><span class=hljs-number >50</span><span class=hljs-punctuation >,</span>
        zoom<span class=hljs-operator >=</span><span class=hljs-number >0.5</span><span class=hljs-punctuation >,</span> phi<span class=hljs-operator >=</span><span class=hljs-number >45</span><span class=hljs-punctuation >,</span>theta<span class=hljs-operator >=</span><span class=hljs-operator >-</span><span class=hljs-number >45</span><span class=hljs-punctuation >,</span>fov<span class=hljs-operator >=</span><span class=hljs-number >70</span><span class=hljs-punctuation >,</span> background <span class=hljs-operator >=</span> <span class=hljs-string >&quot;#F2E1D0&quot;</span><span class=hljs-punctuation >,</span> shadowcolor <span class=hljs-operator >=</span> <span class=hljs-string >&quot;#523E2B&quot;</span><span class=hljs-punctuation >)</span></code></pre> <img src="/images/tmb_rgb_contrast_map_3d.png" alt=""> <img src="/images/giphy.gif" alt=""> <div class=page-foot > <a>linus wolff, personal website.</a> </div> </div> </div> </div>