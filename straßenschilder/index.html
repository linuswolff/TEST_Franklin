<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
     <link rel="stylesheet" href="/libs/highlight/github.min.css">
   
    <link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/tufte.css">
<link rel="stylesheet" href="/css/latex.css">
<link rel="stylesheet" href="/css/adjust.css"> <!-- sheet to overwrite some clashing styles -->
<link rel="icon" href="/assets/lw_initials.png">

     <title>Straßenschilder</title>  

    <link rel="icon" type="image/png" href="/assets/lw_initials.png"> <!-- to show tab icon -->

</head>

<body>
<div id="layout">
  <div id="menu">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/resume/">Resume</a></li>
      <li><a href="/straßenschilder/">Straßenschilder</a></li>
      <li><a href="/map_project/">TMB 3D Map</a></li>
      <li><a href="/CallR/">CallR</a></li>
      <li><a href="/eisbach/">Eisbach</a></li>
      <li><a href="/thesis/">Thesis</a></li>
      <li><a href="https://sql-translator.onrender.com/">translate SQL</a></li>
      <!-- <li><a href="/plots_mine/">nice plots</a></li> -->
      <!-- <li><a href="/MNIST_NN/">NN with MNIST</a></li> -->
    </ul>
  </div>
  <div id="main">


<!-- Content appended here --><div class="franklin-content"><h1 id="straßenschilder"><a href="#straßenschilder" class="header-anchor">Straßenschilder</a></h1>
<p>A little project on training a neural net to classify traffic signs.</p>
<p>We have a dataset of thousands of images of german traffic signs with corresponding labels. In total there are 43 classes of images.</p>
<p>Here is a sample of them:</p>

<pre><code class="plaintext code-output">┌────┬────────────────────────────┬────┬───────────────────────────┐
│ ID │                       Name │ ID │                      Name │
├────┼────────────────────────────┼────┼───────────────────────────┤
│ 27 │                Pedestrians │ 31 │     Wild animals crossing │
│ 21 │               Double curve │ 17 │                  No entry │
│ 15 │                No vehicles │ 22 │                Bumpy road │
│ 28 │          Children crossing │ 38 │                Keep right │
│ 32 │ End speed + passing limits │  4 │      Speed limit (70km/h) │
│ 37 │        Go straight or left │  3 │      Speed limit (60km/h) │
│ 30 │         Beware of ice/snow │ 16 │ Veh > 3.5 tons prohibited │
│ 18 │            General caution │  7 │     Speed limit (100km/h) │
└────┴────────────────────────────┴────┴───────────────────────────┘
</code></pre>
<p>Here are some examples of images in the test data:</p>

<div style="display:flex; justify-content:left;">
  <img src="/images/9_traffic_signs.png" style="width:100%; margin:0; padding:0;">
</div>

<p>The model I trained follows the classic <a href="https://en.wikipedia.org/wiki/LeNet#Structure">LeNet-5</a> architecture, first created for digit recognition in 1989, albeit slighty adjusted. Here, we will simply import the model I have already trained.</p>
<pre><code class="language-python">model &#61; keras.models.load_model&#40;&#39;german_traffic_signs_model.h5&#39;&#41;</code></pre>
<p>We now load in the test data.</p>
<pre><code class="language-python">test &#61; pd.read_csv&#40;data_dir &#43; &#39;/Test.csv&#39;&#41;

labels &#61; test&#91;&quot;ClassId&quot;&#93;.values
imgs &#61; test&#91;&quot;Path&quot;&#93;.values

data &#61; &#91;&#93;

for img in imgs:
    try:
        image &#61; cv2.imread&#40;data_dir &#43; &#39;/&#39; &#43; img&#41;
        image_from_array &#61; Image.fromarray&#40;image, &#39;RGB&#39;&#41;
        size_image &#61; image_from_array.resize&#40;&#40;IMG_HEIGHT, IMG_WIDTH&#41;&#41;
        data.append&#40;np.array&#40;size_image&#41;&#41;
    except:
        print&#40;&quot;Error in &quot; &#43; img&#41;

X_test &#61; np.array&#40;data&#41;
X_test &#61; X_test / 255</code></pre>
<p>And predict the results.</p>
<pre><code class="language-python">pred &#61; model.predict&#40;X_test&#41;
pred &#61; np.argmax&#40;pred, axis&#61;1&#41;</code></pre>
<p>This model has a very good accuracy on the test data.</p>
<pre><code class="language-python">print&#40;&#39;Test Data Accuracy: &#39;, accuracy_score&#40;labels, pred&#41;&#41;</code></pre>
<p>Now let&#39;s test the model with some images from the internet.</p>

<div style="display:flex; justify-content:center;">
  <img src="/images/50kmh_sign.jpeg" style="width:30%; margin:0; padding:0;">
  <img src="/images/30kmh_sign.jpeg" style="width:30%; margin:0; padding:0 25px;">
  <img src="/images/vorfahrt_gewähren_sign.jpeg" style="width:30%;
  margin:0; padding:0;">
</div>

<p>Let&#39;s define a function to classify the images.</p>
<pre><code class="language-python">import requests
from PIL import Image

def classify_german_sign&#40;url&#41;:
    response &#61; requests.get&#40;url, stream&#61;True&#41;
    img &#61; Image.open&#40;response.raw&#41;
    plt.imshow&#40;img, cmap&#61;plt.get_cmap&#40;&#39;gray&#39;&#41;&#41;
    # plt.show&#40;&#41;

    img &#61; np.asarray&#40;img&#41;
    img &#61; cv2.resize&#40;img, &#40;IMG_HEIGHT, IMG_WIDTH&#41;&#41;
    img &#61; img / 255
    img &#61; img.reshape&#40;1, IMG_HEIGHT, IMG_WIDTH, channels&#41;
    # predicting the class
    predicted_class &#61; np.argmax&#40;model.predict&#40;img&#41;, axis&#61;-1&#41;
    # print the class
    print&#40;&quot;This sign belongs to class:&quot;, classes&#91;predicted_class&#91;0&#93;&#93;&#41;</code></pre>
<p>Now let&#39;s test if the model classifies the images correctly.</p>
<pre><code class="language-python">classify_german_sign&#40;url1&#41;</code></pre>
<pre><code class="plaintext code-output">1/1 [==============================] - 0s 142ms/step
This sign belongs to class: Speed limit (50km/h)
</code></pre>
<pre><code class="language-python">classify_german_sign&#40;url2&#41;</code></pre>
<pre><code class="plaintext code-output">1/1 [==============================] - 0s 23ms/step
This sign belongs to class: Speed limit (30km/h)
</code></pre>
<pre><code class="language-python">classify_german_sign&#40;url3&#41;</code></pre>
<pre><code class="plaintext code-output">1/1 [==============================] - 0s 20ms/step
This sign belongs to class: Yield
</code></pre>
<blockquote>
<p>The model identified all three images correctly.</p>
</blockquote>
<p>However, it is not perfect. Let&#39;s see what happens if we give it an image where the sign is not front and center.</p>

<div style="display:flex; justify-content:center;">
  <img src='/images/stopsign_schwer.jpeg' style="width:70%; margin:0; padding:0;">
</div>

<pre><code class="language-python">classify_german_sign&#40;url4&#41;</code></pre>
<pre><code class="plaintext code-output">1/1 [==============================] - 0s 20ms/step
This sign belongs to class: Roundabout mandatory
</code></pre>
<p>The prediction is wrong.</p>
<div class="row"><div class="container"><div class="left"><img src="/images/stoppschild.png" alt="" /></div></div>
<p>Under the hood, this model is a neural network trained on a collection of relatively homogenous training examples that take this form. It is not able to understand the context of the image. It is not able to classify the above image, mainly because it is very different from the training data. 
<div style="clear: both"></div>
</p></div>
<div class="page-foot">
    <a>linus wolff</a>
</div>
</div><!-- CONTENT ENDS HERE -->
        </div> <!-- end of id=main -->
    </div> <!-- end of id=layout -->
    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
