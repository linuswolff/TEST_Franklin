<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/lw_initials.png"> <title>MNIST neural net</title> <link rel=icon  type="image/png" href="/assets/lw_initials.png"> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/menu1/">Code blocks</a> <li><a href="/menu2/">More goodies</a> <li><a href="/menu3/">Tags</a> --> <li><a href="/menu_mine/">nice plots</a> <li><a href="/menu_mine2/">just plots</a> <li><a href="/menu_mine3/">CallR</a> <li><a href="/menu_mine4/">NN with MNIST</a> <li><a href="/menu_mine5/">map project</a> </ul> </div> <div id=main > <div class=franklin-content ><h1 id=mnist_neural_net ><a href="#mnist_neural_net" class=header-anchor >MNIST neural net</a></h1> <p>R code can be called by using <code>R&quot;...&quot;</code>:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> RCall

<span class=hljs-string >R&quot;
library(dplyr)
library(keras)
library(tensorflow)
library(yardstick)

options(scipen = 999)

# this python env seems to work
use_python(&#x27;/usr/local/bin/python3&#x27;)

### test if tensorflow is working
tf<span class=hljs-variable >$print</span>(
  tf<span class=hljs-variable >$constant</span>(&#x27;Hello, TensorFlow!&#x27;)
)
###

# import data

train_mnist &lt;- read.csv(&#x27;~/Documents/code/R_stuff/mnist test/train.csv&#x27;, header = T)

## head(train_mnist)

dim(train_mnist)

# Cross validation

set.seed(123)
index &lt;- sample(x = nrow(train_mnist), 
                size = nrow(train_mnist) * 0.9 )

data_train &lt;- train_mnist[ index, ]
data_test &lt;- train_mnist[ -index, ]

table(data_train<span class=hljs-variable >$label</span>) %&gt;% prop.table()

# seperate target and features

train_x &lt;- data_train %&gt;% 
  select(-label) %&gt;% 
  as.matrix() / 255

test_x &lt;- data_test %&gt;% 
  select(-label) %&gt;% 
  as.matrix() / 255
# show some random values to see if it looks good -&gt; values are [0,1]
train_x[1:10, 203:208]


# multi layer perceptron

train_x_keras &lt;- array_reshape(train_x, dim(train_x))
test_x_keras &lt;- array_reshape(test_x, dim(test_x))

train_y &lt;- to_categorical(data_train<span class=hljs-variable >$label</span>, num_classes = 10)
test_y &lt;- data_test<span class=hljs-variable >$label</span>

# encoded target

cat(&#x27;Encoded Target \n \n&#x27;)
head(train_y)


# building the model architecture

tf<span class=hljs-variable >$random</span><span class=hljs-variable >$set_seed</span>(123)

model &lt;- keras_model_sequential(name = &#x27;MLP_Model&#x27;) %&gt;% 
  layer_dense(units = 512, 
              activation = &#x27;relu&#x27;,
              input_shape = ncol(train_x),
              name = &#x27;Hidden_1&#x27;
  ) %&gt;% 
  layer_dense(units = 128, 
              activation = &#x27;relu&#x27;,
              name = &#x27;Hidden_2&#x27;
  ) %&gt;% 
  layer_dense(units = 32,
              activation = &#x27;relu&#x27;,
              name = &#x27;Hidden_3&#x27;
  ) %&gt;% 
  layer_dense(units = 16,
              activation = &#x27;relu&#x27;,
              name = &#x27;Hidden_4&#x27;
  ) %&gt;% 
  layer_dense(units = 10,
              activation = &#x27;softmax&#x27;
  )

model

# training the model

model %&gt;% 
  compile(loss = &#x27;categorical_crossentropy&#x27;,
          optimizer = optimizer_adam(lr = 0.001),
          metrics = &#x27;accuracy&#x27;
  )

train_history &lt;- model %&gt;% 
  fit(x = train_x_keras,
      y = train_y,
      epochs = 15,
      batch_size = 32,
      validation_split = 0.1,
      verbose = 1
  )

plot(train_history)


# evaluate model on test data

pred_test &lt;- model %&gt;% predict(test_x_keras) %&gt;% k_argmax() %&gt;% as.integer()

pred_acc &lt;- data.frame(Accuracy = accuracy_vec(truth = as.factor(data_test<span class=hljs-variable >$label</span>), 
                          estimate = as.factor(pred_test)),
  
           Recall = sens_vec(truth = as.factor(data_test<span class=hljs-variable >$label</span>),
                    estimate = as.factor(pred_test)),
  
           Precision = precision_vec(truth = as.factor(data_test<span class=hljs-variable >$label</span>), 
                            estimate = as.factor(pred_test)),
  
           F1 = f_meas_vec(truth = as.factor(data_test<span class=hljs-variable >$label</span>), 
                  estimate = as.factor(pred_test)))

# accuracy etc. in percent



pred_acc_new = @rget pred_acc_new

println(pred_acc_new)</span></code></pre> <pre><code class="plaintext hljs">RCall.REvalError(&quot;Error in library(dplyr) : there is no package called ‘dplyr’&quot;)
</code></pre> <p>HELLO</p> <div class=page-foot > <a>linus wolff, personal website.</a> </div> </div> </div> </div>